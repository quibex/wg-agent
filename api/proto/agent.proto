syntax = "proto3";
package wgagent;

import "google/protobuf/empty.proto";

option go_package = "github.com/quibex/wg-agent/api/proto";

// WireGuardAgent - простой API для управления VPN клиентами.
//
// Основные методы:
// - CreateClient: создать нового клиента → получить конфиг, QR, ссылку
// - DisableClient: отключить клиента (подписка закончилась)
// - EnableClient: включить обратно
// - DeleteClient: удалить полностью
// - GetClient: получить информацию о клиенте
//
service WireGuardAgent {
  // CreateClient - создаёт нового VPN клиента.
  // Генерирует ключи, выделяет IP, добавляет в WireGuard.
  // Возвращает всё что нужно для подключения клиента.
  rpc CreateClient(CreateClientRequest) returns (CreateClientResponse);

  // DisableClient - отключает клиента (подписка закончилась).
  // Клиент остаётся в базе, но не может подключиться.
  rpc DisableClient(DisableClientRequest) returns (DisableClientResponse);

  // EnableClient - включает ранее отключенного клиента.
  rpc EnableClient(EnableClientRequest) returns (EnableClientResponse);

  // DeleteClient - полностью удаляет клиента.
  rpc DeleteClient(DeleteClientRequest) returns (google.protobuf.Empty);

  // GetClient - получить информацию о клиенте.
  rpc GetClient(GetClientRequest) returns (GetClientResponse);

  // ListClients - список всех клиентов.
  rpc ListClients(ListClientsRequest) returns (ListClientsResponse);
}

// ============================================================
// CreateClient - создание клиента
// ============================================================

message CreateClientRequest {
  // Уникальный ID пользователя из твоей системы (telegram user_id, username, и т.д.)
  string user_id = 1;
}

message CreateClientResponse {
  // Конфигурационный файл для клиента (.conf)
  // Можно сохранить как файл и импортировать в WireGuard
  string config_file = 1;

  // QR код в base64 (PNG изображение)
  // Для сканирования мобильным приложением
  string qr_code_base64 = 2;

  // Deep link для автоимпорта в приложение WireGuard
  // Формат: wireguard://import/<base64_config>
  // На мобилке откроется приложение и предложит добавить туннель
  string deep_link = 3;

  // Выделенный IP адрес клиента
  string client_ip = 4;
}

// ============================================================
// DisableClient - отключение клиента
// ============================================================

message DisableClientRequest {
  string user_id = 1;
}

message DisableClientResponse {
  bool success = 1;
  string message = 2; // "disabled" или причина ошибки
}

// ============================================================
// EnableClient - включение клиента
// ============================================================

message EnableClientRequest {
  string user_id = 1;
}

message EnableClientResponse {
  bool success = 1;
  string message = 2;
}

// ============================================================
// DeleteClient - удаление клиента
// ============================================================

message DeleteClientRequest {
  string user_id = 1;
}

// ============================================================
// GetClient - информация о клиенте
// ============================================================

message GetClientRequest {
  string user_id = 1;
}

message GetClientResponse {
  string user_id = 1;
  string client_ip = 2;
  bool enabled = 3;

  // Статистика (если клиент подключен)
  int64 rx_bytes = 4;        // скачано байт
  int64 tx_bytes = 5;        // отправлено байт
  int64 last_handshake = 6;  // unix timestamp последнего подключения (0 = никогда)
}

// ============================================================
// ListClients - список клиентов
// ============================================================

message ListClientsRequest {}

message ListClientsResponse {
  repeated ClientInfo clients = 1;
}

message ClientInfo {
  string user_id = 1;
  string client_ip = 2;
  bool enabled = 3;
  int64 last_handshake = 4;
}
